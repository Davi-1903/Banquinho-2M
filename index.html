<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Explorador do Reposit√≥rio livialop/banquinho</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    /* Seu CSS continua o mesmo */
    body { font-family: system-ui, sans-serif; background: #f5f7fa; padding: 30px 20px; line-height: 1.6; }
    h1 { text-align: center; margin-bottom: 30px; color: #333; }
    #viewer { background: white; max-width: 900px; margin: auto; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    #file-list { list-style: none; padding: 0; max-width: 900px; margin: 30px auto; display: grid; gap: 10px; }
    #file-list li a { display: block; padding: 12px 16px; background: white; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; font-weight: 500; color: #333; text-decoration: none; transition: all 0.2s ease; }
    #file-list li a:hover { background: #007bff; color: white; border-color: #007bff; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    pre { overflow-x: auto; border-radius: 6px; padding: 12px; background: #f6f8fa; }
    code { font-family: 'Courier New', monospace; font-size: 14px; }
    .note, .warning, .tip, .important { padding: 1em 1em 1em 3.2em; border-radius: 5px; margin: 1.5em 0; white-space: pre-wrap; position: relative; font-size: 1rem; }
    .note::before, .warning::before, .tip::before, .important::before { position: absolute; left: 1em; top: 1em; font-size: 1.2em; }
    .note { background-color: #eaf4ff; border-left: 5px solid #1d7af3; }
    .note::before { content: "‚ÑπÔ∏è"; }
    .important { background-color: #ffe6e6; border-left: 5px solid #d63333; }
    .important::before { content: "‚ùó"; }
    .warning { background-color: #fff3cd; border-left: 5px solid #ffc107; }
    .warning::before { content: "‚ö†Ô∏è"; }
    .tip { background-color: #d4edda; border-left: 5px solid #28a745; }
    .tip::before { content: "üí°"; }
  </style>
</head>
<body>
  <h1>Explorador de Arquivos ‚Äì banquinho</h1>
  <div id="viewer"></div>
  <ul id="file-list"></ul>

  <script>
    // MUDAN√áA CRUCIAL: Armazenaremos o "mapa" do reposit√≥rio aqui
    let repoManifest = [];

    // REESCRITO: Fun√ß√£o para listar arquivos usando o manifesto local
    function listFiles(path = "") {
      const container = document.getElementById("file-list");
      const viewer = document.getElementById("viewer");
      container.innerHTML = "";
      viewer.innerHTML = "";

      // Bot√£o de voltar
      if (path !== "") {
        const upPath = path.split("/").slice(0, -1).join("/");
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.textContent = "‚¨Ö Voltar";
        a.href = `#/${upPath}`;
        li.appendChild(a);
        container.appendChild(li);
      }

      const depth = path === "" ? 0 : path.split("/").length;
      
      const items = repoManifest.filter(item => {
        if (path === "") {
          // No diret√≥rio raiz, queremos itens sem "/" no caminho
          return !item.path.includes("/");
        }
        // Em subdiret√≥rios, queremos itens que come√ßam com o caminho e t√™m o n√≠vel de profundidade correto
        return item.path.startsWith(path + "/") && item.path.split("/").length === depth + 1;
      });

      items.forEach(item => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        const itemName = item.path.split("/").pop();
        a.textContent = item.type === "dir" ? "üìÅ " + itemName : "üìÑ " + itemName;
        a.href = `#/${item.path}`;
        li.appendChild(a);
        container.appendChild(li);
      });
    }

    // REESCRITO: Fun√ß√£o para ver arquivos buscando localmente
    async function viewFile(path) {
      // Usa fetch com caminho relativo! Sem API.
      const response = await fetch(path);
      const text = await response.text();

      const viewer = document.getElementById("viewer");
      const container = document.getElementById("file-list");
      container.innerHTML = "";

      const ext = path.split(".").pop();

      if (ext === "md") {
        renderMarkdown(text, path);
      } else {
        renderCode(text, path, ext);
      }
    }
    
    // As fun√ß√µes renderCode, renderMarkdown, tratarBlocosEspeciais, e escapeHtml
    // continuam exatamente as mesmas. N√£o precisam de altera√ß√£o.
    function renderCode(text, path, ext) { /* ...c√≥digo original... */ }
    function renderMarkdown(markdown, path) { /* ...c√≥digo original... */ }
    function tratarBlocosEspeciais(markdown) { /* ...c√≥digo original... */ }
    function escapeHtml(unsafe) { /* ...c√≥digo original... */ }

    // REESCRITO: O roteador agora decide o que fazer com base no manifesto
    function router() {
      const hash = window.location.hash.slice(2);
      
      if (hash === "") {
        listFiles("");
        return;
      }

      // Encontra o item no nosso mapa local
      const item = repoManifest.find(i => i.path === hash);

      if (item) {
        if (item.type === 'dir') {
          listFiles(hash);
        } else {
          viewFile(hash);
        }
      } else {
        // Se n√£o encontrar, volta para a raiz
        listFiles("");
      }
    }
    
    // MUDAN√áA CRUCIAL: Fun√ß√£o de inicializa√ß√£o que carrega o manifesto
    async function init() {
        try {
            const response = await fetch('manifest.json');
            repoManifest = await response.json();
            // Ordena para que as pastas apare√ßam antes dos arquivos
            repoManifest.sort((a, b) => {
                if (a.type === 'dir' && b.type === 'file') return -1;
                if (a.type === 'file' && b.type === 'dir') return 1;
                return a.path.localeCompare(b.path);
            });
            
            window.addEventListener("hashchange", router);
            router(); // Inicia o roteador depois que o manifesto foi carregado
        } catch (error) {
            document.body.innerHTML = '<h1>Erro</h1><p>N√£o foi poss√≠vel carregar o arquivo <code>manifest.json</code>. Certifique-se de que ele foi gerado e est√° na raiz do projeto.</p>';
            console.error(error);
        }
    }
    
    // Inicia a aplica√ß√£o
    init();

  </script>
</body>
</html>